<p class="line862">Typically you need to increase&nbsp;<tt class="backtick">vm.kmem_size_max</tt>&nbsp;and&nbsp;<tt class="backtick">vm.kmem_size</tt>&nbsp;(with&nbsp;<tt class="backtick">vm.kmem_size_max</tt>&nbsp;&gt;=&nbsp;<tt class="backtick">vm.kmem_size</tt>) to not get kernel panics (kmem too small). The value depends upon the workload. If you need to extend them beyond 512M, you need to recompile your kernel with increased&nbsp;<a href="http://wiki.freebsd.org/KVA_PAGES">KVA_PAGES</a>&nbsp;option, e.g. add the following line to your kernel configuration file to increase available space for&nbsp;<tt class="backtick">vm.kmem_size</tt>&nbsp;beyond 1&nbsp;GB:</p>
<p class="line867"><tt class="backtick">options&nbsp;KVA_PAGES=512</tt></p>
<p class="line874">To chose a good value for KVA_PAGES read the explanation in the sys/i386/conf/NOTES file.</p>
<p class="line862">By default the kernel receives 1&nbsp;GB of the 4&nbsp;GB of address space available on the i386 architecture, and this is used for all of the kernel address space needs, not just the kmem map. By increasing&nbsp;<a href="http://wiki.freebsd.org/KVA_PAGES">KVA_PAGES</a>&nbsp;you can allocate a larger proportion of the 4&nbsp;GB address space to the kernel (2&nbsp;GB in the above example), allowing more room to increase&nbsp;<tt class="backtick">vm.kmem_size</tt>. The trade-off is that user applications have less address space available, and some programs (e.g. those that rely on mapping data at a fixed address that is now in the kernel address space, or which require close to the full 3&nbsp;GB of address space themselves) may no longer run. If you change KVA_PAGES and the system reboots (no panic) after running a while this may be because the address space for userland applications is too small now.</p>
<p class="line862">For *really* memory constrained systems it is also recommended to strip out as many unused drivers and options from the kernel (which will free a couple of MB of memory). A stable configuration with&nbsp;<tt class="backtick">vm.kmem_size="1536M"</tt>&nbsp;has been reported using an unmodified 7.0-RELEASE kernel, relatively sparse drivers as required for the hardware and&nbsp;<tt class="backtick">options&nbsp;KVA_PAGES=512</tt>.</p>